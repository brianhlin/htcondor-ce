
###############################################################################
#
# HTCondor-CE Central Collector requirements configuration
#
# DO NOT EDIT THIS FILE!  It will be overwritten on upgrades.
# If you wish to make changes to the HTCondor-CE configuration, create files
# in /etc/condor-ce/config.d containing your changes.
#
###############################################################################

# The COLLECTOR_REQUIREMENTS expressions require that CE ads (ad type is
# Scheduler), xrootd startd ads (ad type is Machine) and xrootd master ads
# (ad type is DaemonMaster) have:
# - Name attrs that match the AuthenticatedIdentity attr

# COLLECTOR_REQUIREMENTS subexpression for CE ad
# For a CE ad, the grid_resource must also match Name and AuthenticatedIdentity
# e.g. for this:
# - AuthenticatedIdentity == "ce.example.net@XXXX" (UID namespace doesn't matter)
# you need this:
# - grid_resource == "condor ce.example.net ce.example.net:XXXX" (port doesn't
#   matter for collector address part, and may be absent)
COLLECTOR_REQUIREMENTS = \
  (  (TARGET.MyType == "Scheduler") \
  && (TARGET.Name == splitUserName(TARGET.AuthenticatedIdentity)[0])  \
  && (isString(TARGET.grid_resource))  \
  && (stringListSize(TARGET.grid_resource, ": ") >= 3)  \
  && (split(TARGET.grid_resource, ": ")[1] == splitUserName(TARGET.AuthenticatedIdentity)[0]) \
  && (split(TARGET.grid_resource, ": ")[2] == splitUserName(TARGET.AuthenticatedIdentity)[0]) \
  )

# COLLECTOR_REQUIREMENTS subexpression for xrootd startd ad
COLLECTOR_REQUIREMENTS = $(COLLECTOR_REQUIREMENTS) || \
 (  (TARGET.MyType == "Machine") \
 && (TARGET.Name == strcat("xrootd@", splitUserName(TARGET.AuthenticatedIdentity)[0])) \
 )

# COLLECTOR_REQUIREMENTS subexpression for xrootd master ad
COLLECTOR_REQUIREMENTS = $(COLLECTOR_REQUIREMENTS) || \
 (  (TARGET.MyType == "DaemonMaster") \
 && (TARGET.Name == splitUserName(TARGET.AuthenticatedIdentity)[0]) \
 )

# Accept other ads
COLLECTOR_REQUIREMENTS = $(COLLECTOR_REQUIREMENTS) || \
 ((TARGET.MyType != "Scheduler") && (TARGET.MyType != "Machine") && (TARGET.MyType != "DaemonMaster"))

